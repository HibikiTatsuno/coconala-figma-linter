<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Frame Data Reader</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
      color: #2d3436;
      min-height: 100vh;
      padding: 16px;
    }

    .container {
      max-width: 500px;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #ffeaa7;
    }

    .header h1 {
      color: #e17055;
      font-size: 20px;
      font-weight: bold;
    }

    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 15px;
      justify-content: center;
    }

    .tab-button {
      background: #ddd;
      color: #666;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .tab-button.active {
      background: #e17055;
      color: white;
    }

    .tab-button:hover:not(.active) {
      background: #ccc;
    }

    .instruction {
      background: #81ecec;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      font-size: 11px;
      text-align: center;
    }

    .api-key-section {
      background: #f8f9fa;
      border: 2px solid #e17055;
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
      display: none;
    }

    .api-key-section.show {
      display: block;
    }

    .api-key-label {
      font-size: 11px;
      font-weight: bold;
      color: #2d3436;
      margin-bottom: 5px;
    }

    .api-key-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 11px;
      margin-bottom: 8px;
    }

    .api-key-help {
      font-size: 10px;
      color: #636e72;
      line-height: 1.4;
    }

    .content {
      background: #fdcb6e;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      line-height: 1.6;
      white-space: pre-wrap;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 12px;
      max-height: 350px;
      overflow-y: auto;
      border: 2px solid #e17055;
    }

    .content.json {
      background: #74b9ff;
      color: white;
    }

    .content.error {
      background: #ff7675;
      color: white;
      text-align: center;
      font-weight: bold;
    }

    .content.analysis {
      background: #a29bfe;
      color: white;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 11px;
      line-height: 1.5;
    }

    .content.loading {
      background: #fdcb6e;
      text-align: center;
      font-style: italic;
      color: #636e72;
    }

    .buttons {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    button {
      background: #e17055;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    button:hover {
      background: #d63031;
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    .frame-button {
      background: #00b894;
    }

    .frame-button:hover {
      background: #00a085;
    }

    .ai-button {
      background: #a29bfe;
    }

    .ai-button:hover {
      background: #6c5ce7;
    }

    .footer {
      text-align: center;
      margin-top: 12px;
      font-size: 10px;
      color: #636e72;
    }

    .loading-spinner {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #e17055;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 5px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Frame Data Reader</h1>
      <div style="font-size: 28px; margin: 8px 0;">ğŸŸ¡</div>
      <p style="font-size: 12px; color: #636e72;">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ãƒ€ãƒ¼ + Claude AI</p>
    </div>

    <div class="tabs">
      <button id="tab-md" class="tab-button active">test.mdè¡¨ç¤º</button>
      <button id="tab-frame" class="tab-button">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿</button>
      <button id="tab-analysis" class="tab-button">Claudeåˆ†æ</button>
    </div>

    <div id="instruction" class="instruction">
      test.mdãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è¡¨ç¤ºä¸­
    </div>

    <div id="api-key-section" class="api-key-section">
      <div class="api-key-label">Claude API Key:</div>
      <input type="password" id="api-key-input" class="api-key-input" placeholder="sk-ant-api03-...">
      <div class="api-key-help">
        API Keyã¯Claude Console (console.anthropic.com) ã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚<br>
        å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œãšã€åˆ†ææ™‚ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <div id="content" class="content">
      èª­ã¿è¾¼ã¿ä¸­...
    </div>

    <div class="buttons">
      <button id="btn-content">test.mdå†èª­è¾¼</button>
      <button id="btn-frame" class="frame-button">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
      <button id="btn-analysis" class="ai-button">Claudeåˆ†æå®Ÿè¡Œ</button>
      <button id="btn-close">é–‰ã˜ã‚‹</button>
    </div>

    <div class="footer">
      ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’Claude AIã§åˆ†æã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ âœ¨
    </div>
  </div>

  <script>
    let currentTab = 'md';
          let isLoading = false;

    // DOMè¦ç´ ã®å–å¾—
    const tabMd = document.getElementById('tab-md');
    const tabFrame = document.getElementById('tab-frame');
          const tabAnalysis = document.getElementById('tab-analysis');
    const instruction = document.getElementById('instruction');
          const apiKeySection = document.getElementById('api-key-section');
          const apiKeyInput = document.getElementById('api-key-input');
    const content = document.getElementById('content');
    const btnContent = document.getElementById('btn-content');
    const btnFrame = document.getElementById('btn-frame');
          const btnAnalysis = document.getElementById('btn-analysis');
    const btnClose = document.getElementById('btn-close');

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡é–¢æ•°
    function sendMessage(type, data = {}) {
      parent.postMessage({ pluginMessage: { type, ...data } }, '*');
    }

    function requestContent() {
      sendMessage('request-content');
    }

    function requestFrameData() {
      sendMessage('request-frame-data');
    }

          function requestClaudeAnalysis() {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
              content.textContent = 'ã‚¨ãƒ©ãƒ¼: Claude API ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
              content.className = 'content error';
              return;
            }

            setLoading(true);
            content.textContent = 'Claude AIã§åˆ†æä¸­...\n\nãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã¦ã„ã¾ã™ã€‚\nã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚';
            content.className = 'content loading';

            sendMessage('request-claude-analysis', { apiKey });
          }

    function closePlugin() {
      sendMessage('close-plugin');
    }

          function setLoading(loading) {
            isLoading = loading;
            if (loading) {
              btnAnalysis.innerHTML = '<span class="loading-spinner"></span>åˆ†æä¸­...';
              btnAnalysis.disabled = true;
            } else {
              btnAnalysis.innerHTML = 'Claudeåˆ†æå®Ÿè¡Œ';
              btnAnalysis.disabled = false;
            }
          }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(tab) {
      currentTab = tab;

      // ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
      tabMd.classList.remove('active');
      tabFrame.classList.remove('active');
      tabAnalysis.classList.remove('active');
      
      if (tab === 'md') {
        tabMd.classList.add('active');
        apiKeySection.classList.remove('show');
        requestContent();
      } else if (tab === 'frame') {
        tabFrame.classList.add('active');
        apiKeySection.classList.remove('show');
        instruction.textContent = 'ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸æŠã—ã¦ã‹ã‚‰ã€Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„';
        content.textContent = 'ãƒ•ãƒ¬ãƒ¼ãƒ ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“...\n\n1. Figmaã§ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸æŠã™ã‚‹\n2. ã€Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\n3. ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±ãŒJSONã§è¡¨ç¤ºã•ã‚Œã‚‹';
        content.className = 'content';
      } else if (tab === 'analysis') {
        tabAnalysis.classList.add('active');
        apiKeySection.classList.add('show');
        instruction.textContent = 'Claude AIãŒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’åˆ†æã—ã¾ã™';
        content.textContent = 'Claude AIåˆ†æã®æº–å‚™ä¸­...\n\n1. Figmaã§ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸æŠã™ã‚‹\n2. Claude API ã‚­ãƒ¼ã‚’å…¥åŠ›ã™ã‚‹\n3. ã€ŒClaudeåˆ†æå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\n4. AIåˆ†æçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹';
        content.className = 'content';
      }
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    tabMd.addEventListener('click', () => switchTab('md'));
    tabFrame.addEventListener('click', () => switchTab('frame'));
          tabAnalysis.addEventListener('click', () => switchTab('analysis'));
    btnContent.addEventListener('click', requestContent);
    btnFrame.addEventListener('click', requestFrameData);
          btnAnalysis.addEventListener('click', requestClaudeAnalysis);
    btnClose.addEventListener('click', closePlugin);

    // Figmaãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
    window.addEventListener('message', (event) => {
      const msg = event.data.pluginMessage;

      if (msg.type === 'content-loaded') {
        content.textContent = msg.content;
        content.className = 'content';
        instruction.textContent = 'test.mdãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è¡¨ç¤ºä¸­ã§ã™';
      }

      if (msg.type === 'frame-data-loaded') {
        const frameData = msg.frameData;

        if (frameData.error) {
          content.textContent = frameData.message;
          content.className = 'content error';
        } else {
          const jsonString = JSON.stringify(frameData.data, null, 2);
          content.textContent = jsonString;
          content.className = 'content json';
          instruction.textContent = `ãƒ•ãƒ¬ãƒ¼ãƒ ã€Œ${frameData.data.name}ã€ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºä¸­ã§ã™`;
        }
      }

      if (msg.type === 'claude-analysis-loaded') {
        setLoading(false);
        const analysisData = msg.analysisData;

        if (analysisData.error) {
          content.textContent = analysisData.message;
          content.className = 'content error';
          instruction.textContent = 'Claude AIåˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
        } else {
          content.textContent = analysisData.analysis;
          content.className = 'content analysis';
          instruction.textContent = 'Claude AIã«ã‚ˆã‚‹åˆ†æçµæœã‚’è¡¨ç¤ºä¸­ã§ã™';
        }
      }
    });

    // åˆæœŸåŒ–
    setTimeout(requestContent, 300);
  </script>
</body>

</html>